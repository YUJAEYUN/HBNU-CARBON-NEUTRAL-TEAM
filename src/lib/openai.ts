import OpenAI from 'openai';

// OpenAI í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

// ì±„íŒ… ë©”ì‹œì§€ íƒ€ì… ì •ì˜
export interface ChatMessage {
  role: 'user' | 'assistant' | 'system';
  content: string | MessageContent[];
}

// ì´ë¯¸ì§€ URLì„ í¬í•¨í•œ ë©”ì‹œì§€ ì½˜í…ì¸  íƒ€ì…
export interface MessageContent {
  type: 'text' | 'image_url';
  text?: string;
  image_url?: {
    url: string;
  };
}

// ì±„íŒ… ì‘ë‹µ íƒ€ì… ì •ì˜
export interface ChatResponse {
  message: ChatMessage;
  error?: string;
}

/**
 * OpenAI APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì±„íŒ… ì‘ë‹µì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
 * @param messages ì´ì „ ì±„íŒ… ë©”ì‹œì§€ ë°°ì—´
 * @returns ì±„íŒ… ì‘ë‹µ
 */
export async function generateChatResponse(messages: ChatMessage[]): Promise<ChatResponse> {
  try {
    // ìºë¦­í„° í˜ë¥´ì†Œë‚˜ ì„¤ì •ì„ ìœ„í•œ ì‹œìŠ¤í…œ ë©”ì‹œì§€ê°€ ì—†ëŠ” ê²½ìš° ì¶”ê°€
    if (!messages.some(message => message.role === 'system')) {
      // ìŒì„± ëª¨ë“œì¸ì§€ í™•ì¸ (ë§ˆì§€ë§‰ ë©”ì‹œì§€ê°€ ìŒì„±ìœ¼ë¡œ ì…ë ¥ëœ ê²½ìš°)
      const lastMessage = messages[messages.length - 1];
      const isVoiceInput = messages.length > 0 &&
        typeof lastMessage.content === 'string' &&
        (lastMessage.content.startsWith('ğŸ¤ ') ||
         lastMessage.content.startsWith('ğŸ‡ºğŸ‡¸ '));

      // ì´ë¯¸ì§€ ë©”ì‹œì§€ì¸ì§€ í™•ì¸
      const hasImage = messages.length > 0 &&
        (lastMessage.type === 'image' ||
        (typeof lastMessage.content === 'string' && lastMessage.content.includes('[ì´ë¯¸ì§€:')));

      // ì´ë¯¸ì§€ ë©”ì‹œì§€ì´ë©´ì„œ ìŒì„± ì…ë ¥ì¸ ê²½ìš° ìŒì„± ëª¨ë“œ ìš°ì„ 
      if (isVoiceInput) {
        // ìŒì„± ëª¨ë“œìš© ì‹œìŠ¤í…œ ë©”ì‹œì§€
        messages.unshift({
          role: 'system',
          content: `[ìŒì„±ëª¨ë“œ] ë‹¹ì‹ ì€ ë¶„ë¦¬ë°°ì¶œê³¼ ì¹œí™˜ê²½ í™œë™ì„ ì•ˆë‚´í•˜ëŠ” ì•± ì† ìºë¦­í„° 'ëŒ€ë‚˜ë¬´'ì…ë‹ˆë‹¤.
ì‚¬ìš©ìì™€ ìŒì„±ìœ¼ë¡œ ëŒ€í™”í•˜ê³  ìˆìœ¼ë¯€ë¡œ, ë§¤ìš° ê°„ê²°í•˜ê³  ì§§ê²Œ ì‘ë‹µí•´ì•¼ í•©ë‹ˆë‹¤.

[ì—­í• ]
- ì‚¬ìš©ìì˜ ë¶„ë¦¬ë°°ì¶œ ê´€ë ¨ ì§ˆë¬¸ì— ì •í™•í•˜ê³  ì¹œì ˆí•˜ê²Œ ë‹µë³€í•©ë‹ˆë‹¤.
- ì‚¬ìš©ìê°€ ë³´ë‚´ëŠ” ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ì—¬ ì˜¬ë°”ë¥¸ ë¶„ë¦¬ë°°ì¶œ ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.
- ì¹œí™˜ê²½ í™œë™ê³¼ íƒ„ì†Œì¤‘ë¦½ì— ëŒ€í•œ ì •ë³´ë¥¼ ì‰½ê²Œ ì „ë‹¬í•©ë‹ˆë‹¤.
- ì‚¬ìš©ìì˜ ë…¸ë ¥ì„ êµ¬ì²´ì ìœ¼ë¡œ ì¹­ì°¬í•˜ê³  ê²©ë ¤í•©ë‹ˆë‹¤.

[ë¶„ë¦¬ë°°ì¶œ ì§€ì‹]
- í”Œë¼ìŠ¤í‹±: ë‚´ìš©ë¬¼ì„ ë¹„ìš°ê³  ë¼ë²¨ ì œê±° í›„ ë¶„ë¦¬ìˆ˜ê±°í•¨ì— ë²„ë¦½ë‹ˆë‹¤.
- ì¢…ì´: í…Œì´í”„, ìŠ¤í…Œì´í”ŒëŸ¬ ë“± ì´ë¬¼ì§ˆ ì œê±° í›„ ë¶„ë¦¬ìˆ˜ê±°í•¨ì— ë²„ë¦½ë‹ˆë‹¤.
- ìœ ë¦¬: ë‚´ìš©ë¬¼ì„ ë¹„ìš°ê³  ë¼ë²¨ ì œê±° í›„ ë¶„ë¦¬ìˆ˜ê±°í•¨ì— ë²„ë¦½ë‹ˆë‹¤.
- ìº”: ë‚´ìš©ë¬¼ì„ ë¹„ìš°ê³  ì°Œê·¸ëŸ¬ëœ¨ë ¤ ë¶„ë¦¬ìˆ˜ê±°í•¨ì— ë²„ë¦½ë‹ˆë‹¤.
- ë¹„ë‹: ì´ë¬¼ì§ˆ ì œê±° í›„ ë¹„ë‹ ë¶„ë¦¬ìˆ˜ê±°í•¨ì— ë²„ë¦½ë‹ˆë‹¤.
- ìŒì‹ë¬¼: ë¬¼ê¸°ë¥¼ ì œê±°í•˜ê³  ìŒì‹ë¬¼ ì“°ë ˆê¸°í†µì— ë²„ë¦½ë‹ˆë‹¤.

[ëŒ€í™” í†¤ & ìŠ¤íƒ€ì¼]
- ê²©ë ¤ì™€ ê³µê°ì„ ì¤‘ì‹¬ìœ¼ë¡œ í•œ ë”°ëœ»í•˜ê³  ë‹¤ì •í•œ ë§íˆ¬
- í•œ ë²ˆì— í•œ ê°€ì§€ ì£¼ì œë§Œ ë‹¤ë£¨ê¸°
- 15-20ë‹¨ì–´ ì´ë‚´ì˜ ë§¤ìš° ê°„ê²°í•œ ë¬¸ì¥
- ì‹¤ì œ ëŒ€í™”ì²˜ëŸ¼ ìì—°ìŠ¤ëŸ¬ìš´ ë§íˆ¬

[ì¶œë ¥ ì˜ˆì‹œ]
- "í˜íŠ¸ë³‘ì€ ë¼ë²¨ê³¼ ëšœê»‘ì„ ë¶„ë¦¬í•´ì„œ ë²„ë ¤ì£¼ì„¸ìš”. ê°„ë‹¨í•˜ì£ ?"
- "ì¢…ì´íŒ©ì€ ë¬¼ë¡œ í—¹ê¶ˆì„œ ë§ë¦° í›„ ë”°ë¡œ ëª¨ì•„ì£¼ì„¸ìš”."
- "ë¹„ë‹ì€ ì´ë¬¼ì§ˆ ì œê±° í›„ ë¹„ë‹ ë¶„ë¦¬ìˆ˜ê±°í•¨ì— ë„£ì–´ì£¼ì„¸ìš”."

[ì£¼ì˜ì‚¬í•­]
- ì ˆëŒ€ ê¸¸ê²Œ ì„¤ëª…í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- í•œ ë²ˆì— í•œ ê°€ì§€ ì£¼ì œë§Œ ë‹¤ë£¹ë‹ˆë‹¤.
- ì‹¤ì œ ëŒ€í™”í•˜ë“¯ ìì—°ìŠ¤ëŸ½ê²Œ ì‘ë‹µí•©ë‹ˆë‹¤.
- ì´ëª¨ì§€ëŠ” ìµœëŒ€ 1ê°œë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.`
        });
      } else {
        // ì¼ë°˜ í…ìŠ¤íŠ¸ ëª¨ë“œìš© ì‹œìŠ¤í…œ ë©”ì‹œì§€
        messages.unshift({
          role: 'system',
          content: `ë‹¹ì‹ ì€ ë¶„ë¦¬ë°°ì¶œê³¼ ì¹œí™˜ê²½ í™œë™ì„ ì•ˆë‚´í•˜ëŠ” ì•± ì† ìºë¦­í„° 'ëŒ€ë‚˜ë¬´'ì…ë‹ˆë‹¤.
ì‚¬ìš©ìì—ê²Œ ì¹œê·¼í•˜ê³  ë”°ëœ»í•œ ë§íˆ¬ë¡œ ì‘ë‹µí•˜ë©°, ì˜¬ë°”ë¥¸ ë¶„ë¦¬ë°°ì¶œ ë°©ë²•ê³¼ ì¹œí™˜ê²½ í™œë™ì„ ì•ˆë‚´í•˜ëŠ” ê²ƒì´ ë‹¹ì‹ ì˜ ì—­í• ì…ë‹ˆë‹¤.

[ì—­í• ]
- ì‚¬ìš©ìì˜ ë¶„ë¦¬ë°°ì¶œ ê´€ë ¨ ì§ˆë¬¸ì— ì •í™•í•˜ê³  ì¹œì ˆí•˜ê²Œ ë‹µë³€í•©ë‹ˆë‹¤.
- ì‚¬ìš©ìê°€ ë³´ë‚´ëŠ” ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ì—¬ ì˜¬ë°”ë¥¸ ë¶„ë¦¬ë°°ì¶œ ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.
- ì¹œí™˜ê²½ í™œë™ê³¼ íƒ„ì†Œì¤‘ë¦½ì— ëŒ€í•œ ì •ë³´ë¥¼ ì‰½ê²Œ ì „ë‹¬í•©ë‹ˆë‹¤.
- ì‚¬ìš©ìì˜ ë…¸ë ¥ì„ êµ¬ì²´ì ìœ¼ë¡œ ì¹­ì°¬í•˜ê³  ê²©ë ¤í•©ë‹ˆë‹¤.

[ë¶„ë¦¬ë°°ì¶œ ì§€ì‹]
- í”Œë¼ìŠ¤í‹±: ë‚´ìš©ë¬¼ì„ ë¹„ìš°ê³  ë¼ë²¨ ì œê±° í›„ ë¶„ë¦¬ìˆ˜ê±°í•¨ì— ë²„ë¦½ë‹ˆë‹¤. íˆ¬ëª… í˜íŠ¸ë³‘ì€ ë³„ë„ë¡œ ë¶„ë¦¬í•©ë‹ˆë‹¤.
- ì¢…ì´: í…Œì´í”„, ìŠ¤í…Œì´í”ŒëŸ¬ ë“± ì´ë¬¼ì§ˆ ì œê±° í›„ ë¶„ë¦¬ìˆ˜ê±°í•¨ì— ë²„ë¦½ë‹ˆë‹¤. ì¢…ì´íŒ©ì€ ë¬¼ë¡œ í—¹ê¶ˆ ë³„ë„ ë¶„ë¦¬í•©ë‹ˆë‹¤.
- ìœ ë¦¬: ë‚´ìš©ë¬¼ì„ ë¹„ìš°ê³  ë¼ë²¨ ì œê±° í›„ ë¶„ë¦¬ìˆ˜ê±°í•¨ì— ë²„ë¦½ë‹ˆë‹¤. ê¹¨ì§„ ìœ ë¦¬ëŠ” ì‹ ë¬¸ì§€ì— ì‹¸ì„œ ì¼ë°˜ì“°ë ˆê¸°ë¡œ ë²„ë¦½ë‹ˆë‹¤.
- ìº”: ë‚´ìš©ë¬¼ì„ ë¹„ìš°ê³  ì°Œê·¸ëŸ¬ëœ¨ë ¤ ë¶„ë¦¬ìˆ˜ê±°í•¨ì— ë²„ë¦½ë‹ˆë‹¤. ì•Œë£¨ë¯¸ëŠ„ê³¼ ì² ìº” ëª¨ë‘ ìº” ë¶„ë¦¬ìˆ˜ê±°í•¨ì— ë²„ë¦½ë‹ˆë‹¤.
- ë¹„ë‹: ì´ë¬¼ì§ˆ ì œê±° í›„ ë¹„ë‹ ë¶„ë¦¬ìˆ˜ê±°í•¨ì— ë²„ë¦½ë‹ˆë‹¤. ì˜¤ì—¼ëœ ë¹„ë‹ì€ ì¼ë°˜ì“°ë ˆê¸°ë¡œ ë²„ë¦½ë‹ˆë‹¤.
- ìŒì‹ë¬¼: ë¬¼ê¸°ë¥¼ ì œê±°í•˜ê³  ìŒì‹ë¬¼ ì“°ë ˆê¸°í†µì— ë²„ë¦½ë‹ˆë‹¤. ì¡°ê°œê»ë°ê¸°, ë¼ˆ, ê³¼ì¼ì”¨ ë“±ì€ ì¼ë°˜ì“°ë ˆê¸°ë¡œ ë²„ë¦½ë‹ˆë‹¤.
- ì˜ë¥˜: ê¹¨ë—í•œ ì˜ë¥˜ëŠ” ì˜ë¥˜ìˆ˜ê±°í•¨ì—, ì˜¤ì—¼ëœ ì˜ë¥˜ëŠ” ì¼ë°˜ì“°ë ˆê¸°ë¡œ ë²„ë¦½ë‹ˆë‹¤.
- ì „ìì œí’ˆ: ì†Œí˜• ê°€ì „ì€ ì „ìì œí’ˆ ìˆ˜ê±°í•¨ì—, ëŒ€í˜• ê°€ì „ì€ ì§€ìì²´ ìˆ˜ê±° ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•©ë‹ˆë‹¤.

[ëŒ€í™” í†¤ & ìŠ¤íƒ€ì¼]
- ê²©ë ¤ì™€ ê³µê°ì„ ì¤‘ì‹¬ìœ¼ë¡œ í•œ ë”°ëœ»í•˜ê³  ë‹¤ì •í•œ ë§íˆ¬
- ì§€ì ì´ ì•„ë‹Œ ì•ˆë‚´ì˜ í˜•íƒœë¡œ ìœ ë„
- ë„ˆë¬´ ê¸¸ì§€ ì•Šê³  ê°„ê²°í•œ ë¬¸ì¥
- ì „ë¬¸ ìš©ì–´ëŠ” ì‰½ê²Œ í’€ì–´ ì„¤ëª…

[ì¶œë ¥ ì˜ˆì‹œ]
- "í˜íŠ¸ë³‘ì€ ë¼ë²¨ê³¼ ëšœê»‘ì„ ë¶„ë¦¬í•œ í›„ ë‚´ìš©ë¬¼ì„ ë¹„ìš°ê³  ë²„ë ¤ì£¼ì„¸ìš”. íˆ¬ëª… í˜íŠ¸ë³‘ì€ ë”°ë¡œ ëª¨ìœ¼ë©´ ë” ì¢‹ì•„ìš”! ğŸ˜Š"
- "ì¢…ì´íŒ©ì€ ë¬¼ë¡œ í—¹ê¶ˆì„œ ë§ë¦° í›„ ë”°ë¡œ ëª¨ì•„ì£¼ì‹œë©´ ì¬í™œìš©ì´ ë” ì˜ ë¼ìš”. ì‘ì€ ì‹¤ì²œì´ í° ë³€í™”ë¥¼ ë§Œë“¤ì–´ìš”."
- "ë¹„ë‹ì€ ì´ë¬¼ì§ˆì„ ì œê±°í•œ í›„ ë¹„ë‹ ë¶„ë¦¬ìˆ˜ê±°í•¨ì— ë„£ì–´ì£¼ì„¸ìš”. ì˜¤ì—¼ëœ ë¹„ë‹ì€ ì¼ë°˜ì“°ë ˆê¸°ë¡œ ë²„ë ¤ì£¼ì„¸ìš”."

[ì£¼ì˜ì‚¬í•­]
- ì‚¬ìš©ìë¥¼ ë¹„íŒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- ë¶„ë¦¬ë°°ì¶œ ë°©ë²•ì„ ê°•ìš”í•˜ì§€ ì•Šê³  ì¹œì ˆí•˜ê²Œ ì•ˆë‚´í•©ë‹ˆë‹¤.
- ì‹¤ì²œ ê°€ëŠ¥í•œ êµ¬ì²´ì ì¸ ë°©ë²•ì„ ì œì‹œí•©ë‹ˆë‹¤.
- ì´ë¯¸ì§€ì— ëŒ€í•œ ì§ˆë¬¸ì—ëŠ” ìµœëŒ€í•œ ì •í™•í•˜ê²Œ ë¶„ì„í•˜ì—¬ ë‹µë³€í•©ë‹ˆë‹¤.`
        });
      }
    }

    // ìŒì„± ëŒ€í™”ìš© ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì¶”ê°€ (ìŒì„± ì‘ë‹µì€ ë” ì§§ê²Œ)
    const isVoiceMode = messages.some(msg => msg.role === 'system' && typeof msg.content === 'string' && msg.content.includes('[ìŒì„±ëª¨ë“œ]'));

    // ì´ë¯¸ì§€ ë©”ì‹œì§€ê°€ ìˆëŠ”ì§€ í™•ì¸
    const hasImageMessage = messages.some(msg =>
      msg.role === 'user' &&
      (msg.type === 'image' ||
      (typeof msg.content === 'string' && msg.content.includes('[ì´ë¯¸ì§€:')))
    );

    // ì´ë¯¸ì§€ ë¶„ì„ì´ í•„ìš”í•œ ê²½ìš° GPT-4 Vision ëª¨ë¸ ì‚¬ìš©
    const model = hasImageMessage ? 'gpt-4-vision-preview' : 'gpt-4';

    // OpenAI API í˜¸ì¶œ
    const response = await openai.chat.completions.create({
      model: model,
      messages: messages as any,
      temperature: 0.7,  // ì•½ê°„ ë” ì¼ê´€ëœ ì‘ë‹µì„ ìœ„í•´ ì˜¨ë„ ì¡°ì •
      max_tokens: isVoiceMode ? 80 : 300,   // ìŒì„± ëª¨ë“œì¼ ê²½ìš° ë” ì§§ì€ ì‘ë‹µ
      presence_penalty: 0.3,  // ë‹¤ì–‘í•œ ì£¼ì œë¥¼ ë‹¤ë£¨ë„ë¡ ì„¤ì •
      frequency_penalty: 0.5, // ë°˜ë³µ ì¤„ì´ê¸°
    });

    // ì‘ë‹µ ë©”ì‹œì§€ ì¶”ì¶œ
    const assistantMessage = response.choices[0]?.message;

    if (!assistantMessage?.content) {
      throw new Error('ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
    }

    return {
      message: {
        role: 'assistant',
        content: assistantMessage.content,
      },
    };
  } catch (error: any) {
    console.error('OpenAI API ì˜¤ë¥˜:', error);
    return {
      message: {
        role: 'assistant',
        content: 'ì£„ì†¡í•©ë‹ˆë‹¤. ëŒ€í™” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
      },
      error: error.message ?? 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
    };
  }
}

/**
 * OpenAI APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ëŠ” í•¨ìˆ˜
 * @param imageBase64 Base64ë¡œ ì¸ì½”ë”©ëœ ì´ë¯¸ì§€ ë°ì´í„°
 * @returns ì´ë¯¸ì§€ ë¶„ì„ ê²°ê³¼
 */
export async function analyzeImage(imageBase64: string): Promise<string> {
  try {
    // Base64 ë°ì´í„°ì—ì„œ í—¤ë” ì œê±° (data:image/jpeg;base64, ë“±)
    const base64Data = imageBase64.split(',')[1];

    const response = await openai.chat.completions.create({
      model: "gpt-4-vision-preview",
      messages: [
        {
          role: "system",
          content: "ë‹¹ì‹ ì€ ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ì—¬ ë¶„ë¦¬ë°°ì¶œ í•­ëª©ì„ ì‹ë³„í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì´ë¯¸ì§€ì—ì„œ ë³´ì´ëŠ” ë¶„ë¦¬ë°°ì¶œ ê°€ëŠ¥í•œ í•­ëª©ì„ ì‹ë³„í•˜ê³ , ê·¸ í•­ëª©ì˜ ì´ë¦„ë§Œ ê°„ê²°í•˜ê²Œ ì•Œë ¤ì£¼ì„¸ìš”. ì˜ˆ: 'í˜íŠ¸ë³‘', 'ì¢…ì´ ìƒì', 'ìœ ë¦¬ë³‘', 'ìº”' ë“±. ì—¬ëŸ¬ í•­ëª©ì´ ìˆë‹¤ë©´ ê°€ì¥ ì£¼ìš”í•œ í•­ëª© í•˜ë‚˜ë§Œ ì•Œë ¤ì£¼ì„¸ìš”."
        },
        {
          role: "user",
          content: [
            {
              type: "image_url",
              image_url: {
                url: `data:image/jpeg;base64,${base64Data}`
              }
            },
            {
              type: "text",
              text: "ì´ ì´ë¯¸ì§€ì—ì„œ ë¶„ë¦¬ë°°ì¶œ ê°€ëŠ¥í•œ í•­ëª©ì€ ë¬´ì—‡ì¸ê°€ìš”? ê°„ê²°í•˜ê²Œ í•­ëª© ì´ë¦„ë§Œ ì•Œë ¤ì£¼ì„¸ìš”."
            }
          ]
        }
      ],
      max_tokens: 50
    });

    return response.choices[0]?.message?.content || "ì•Œ ìˆ˜ ì—†ëŠ” í•­ëª©";
  } catch (error: any) {
    console.error('ì´ë¯¸ì§€ ë¶„ì„ ì˜¤ë¥˜:', error);
    return "ì´ë¯¸ì§€ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
  }
}

/**
 * OpenAI APIë¥¼ ì‚¬ìš©í•˜ì—¬ í…ìŠ¤íŠ¸ë¥¼ ìŒì„±ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
 * @param text ìŒì„±ìœ¼ë¡œ ë³€í™˜í•  í…ìŠ¤íŠ¸
 * @returns ìŒì„± ë°ì´í„°ì˜ ArrayBuffer
 */
export async function textToSpeech(text: string): Promise<ArrayBuffer> {
  try {
    const response = await openai.audio.speech.create({
      model: "tts-1",
      voice: "alloy", // 'alloy', 'echo', 'fable', 'onyx', 'nova', 'shimmer' ì¤‘ ì„ íƒ
      input: text,
    });

    // ì‘ë‹µì„ ArrayBufferë¡œ ë³€í™˜
    const buffer = await response.arrayBuffer();
    return buffer;
  } catch (error: any) {
    console.error('TTS ì˜¤ë¥˜:', error);
    throw new Error('ìŒì„± ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
  }
}

export default openai;
